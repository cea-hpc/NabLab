
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This is the documentation website of NabLab project">
      
      
        <meta name="author" content="Benoit Lelandais">
      
      
        <link rel="canonical" href="https://cea-hpc.github.io/NabLab/debug/">
      
      <link rel="icon" href="../img/logo_512.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Monitoring and debugging - NabLab documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.472b142f.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.08040f6c.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="orange">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#monitoring-and-debugging" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="NabLab documentation" class="md-header__button md-logo" aria-label="NabLab documentation" data-md-component="logo">
      
  <img src="../img/logo_512.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NabLab documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Monitoring and debugging
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="NabLab documentation" class="md-nav__button md-logo" aria-label="NabLab documentation" data-md-component="logo">
      
  <img src="../img/logo_512.png" alt="logo">

    </a>
    NabLab documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        What is NabLab
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../gettingstarted/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../firstmodule/" class="md-nav__link">
        My first module
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../firstextension/" class="md-nav__link">
        My first extension
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../modulecomposition/" class="md-nav__link">
        Composing modules
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Monitoring and debugging
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Monitoring and debugging
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-and-configuring-monilog-in-nablab" class="md-nav__link">
    Installing and configuring MoniLog in NabLab
  </a>
  
    <nav class="md-nav" aria-label="Installing and configuring MoniLog in NabLab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syntax" class="md-nav__link">
    Syntax
  </a>
  
    <nav class="md-nav" aria-label="Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    Expressions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layouts" class="md-nav__link">
    Layouts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moniloggers" class="md-nav__link">
    Moniloggers
  </a>
  
    <nav class="md-nav" aria-label="Moniloggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditions" class="md-nav__link">
    Conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
    <nav class="md-nav" aria-label="Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#printing-to-the-console" class="md-nav__link">
    Printing to the console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printing-to-a-file" class="md-nav__link">
    Printing to a file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assigning-values" class="md-nav__link">
    Assigning values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    Complete examples
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../nablablanguage/" class="md-nav__link">
        NabLab language reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ngenlanguage/" class="md-nav__link">
        Ngen language reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../docker/" class="md-nav__link">
        Docker integration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../arcane/" class="md-nav__link">
        Arcane code generation
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installing-and-configuring-monilog-in-nablab" class="md-nav__link">
    Installing and configuring MoniLog in NabLab
  </a>
  
    <nav class="md-nav" aria-label="Installing and configuring MoniLog in NabLab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#syntax" class="md-nav__link">
    Syntax
  </a>
  
    <nav class="md-nav" aria-label="Syntax">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#imports" class="md-nav__link">
    Imports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#events" class="md-nav__link">
    Events
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expressions" class="md-nav__link">
    Expressions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#layouts" class="md-nav__link">
    Layouts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#moniloggers" class="md-nav__link">
    Moniloggers
  </a>
  
    <nav class="md-nav" aria-label="Moniloggers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#conditions" class="md-nav__link">
    Conditions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
    <nav class="md-nav" aria-label="Actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#printing-to-the-console" class="md-nav__link">
    Printing to the console
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#printing-to-a-file" class="md-nav__link">
    Printing to a file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assigning-values" class="md-nav__link">
    Assigning values
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-examples" class="md-nav__link">
    Complete examples
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="monitoring-and-debugging">Monitoring and debugging</h1>
<p>NabLab debugger is part of the <a href="http://gemoc.org/debug4science/">Debug4Science project</a>.</p>
<p><center>
<img src="http://gemoc.org/debug4science/img/cea.png" alt="CEA" style="width: 100px;"/>
&nbsp;&nbsp;&nbsp;
<img src="http://gemoc.org/debug4science/img/inria.png" alt="Inria" style="width: 150px;"/>
</center></p>
<p>The NabLab debugger relies on MoniLog, a language to define monitors, loggers, and a mix of both called <em>moniloggers</em>.</p>
<h2 id="installing-and-configuring-monilog-in-nablab">Installing and configuring MoniLog in NabLab</h2>
<h3 id="installation">Installation</h3>
<p>To install MoniLog in your NabLab IDE, go to the <em>Help &gt; Install New Software</em> menu.</p>
<p align=center>
<img src="img/NabLab_install_new_software_menu.png" alt="Install New Software Menu" title="Install New Software Menu" width="50%" />
</p>

<p>Then, clik on the <em>Add</em> button.</p>
<p align=center>
<img src="img/NabLab_install_new_software_dialog.png" alt="Install New Software Dialog" title="Install New Software Dialog" width="60%" />
</p>

<p>In the newly opened dialog select <em>Archive</em> and provide the .zip file available <a href="https://github.com/cea-hpc/Monilog4NabLab/releases/tag/v0.4.2">here</a>.
Tick the box and click <em>Next</em>, then click <em>Finish</em>.</p>
<p align=center>
<img src="img/NabLab_install_monilog4nablab.png" alt="Install MoniLog4NabLab" title="Install MoniLog4NabLab" width="60%" />
</p>

<p>You will be prompted twice to <em>Install anyway</em>.
NabLab will then download the required version of GraalVM if it has not yet been installed (this can take a few minutes).
Once the installation is complete, NabLab will prompt you to <em>Restart now</em>.
If GraalVM was downloaded as part of the installation, do not accept, and instead restart the IDE by hand.</p>
<p>If you wish to call Python code from moniloggers, navigate to the root folder of your NabLab IDE in the terminal, and run the following commands to install Python, create and activate a virtual environment, and install numpy and pandas there (this last step can take a dozen of minutes):</p>
<div class="highlight"><pre><span></span><code>./graalvm-ce-java11-21.1.0/bin/gu install python
./graalvm-ce-java11-21.1.0/bin/graalpython -m venv nablab-venv
cd nablab-venv
source bin/activate
graalpython -m ginstall install pandas
</code></pre></div>
<p>You are now able to use MoniLog to define moniloggers for NabLab.</p>
<h3 id="configuration">Configuration</h3>
<p>To enable MoniLog for a NabLab project, add the following dependencies to your <code>MANIFEST.MF</code> located in the <code>META-INF</code> folder of the project:</p>
<div class="highlight"><pre><span></span><code>org.gemoc.monilog,
fr.cea.nabla.ui.graalvm
</code></pre></div>
<p align=center>
<img src="img/NabLab_monilog_dependencies.png" alt="MoniLog Dependencies" title="MoniLog Dependencies" width="60%" />
</p>

<p>Next, before you can define moniloggers, you need to generate the instrumentation interface of the NabLab application you wish to debug.
To do this, right-click the .ngen file of your application, and click on <em>Generate Instrumentation Interface</em>.</p>
<p>You can now create MoniLog (.mnlg) files in your workspace.</p>
<h2 id="syntax">Syntax</h2>
<h3 id="imports">Imports</h3>
<p>The MoniLog language allows to import other MoniLog packages so that the entities declared within can be used, including the <code>org.gemoc.monilog.stl</code> package, which contains some basic layouts and appenders.
The language also allows to import files from other languages (such as Python) under an alias to be able to call the functions defined within.</p>
<div class="highlight"><pre><span></span><code>import org.gemoc.monilog.stl.*
import fr.cea.nabla.monilog.nablalib.*
import &quot;$MONILOG_HOME/monilog-libraries/utils.py&quot; as utils
import IterativeHeatEquation.*
</code></pre></div>
<p>This snippet imports the aforementionned standard library of MoniLog, as well as a NabLab-specific library allowing to print to the NabLab console.
It also imports a Python file to be used later, and the <code>IterativeHeatEquation</code> NabLab module, to de able to refer to the variables, jobs and functions defined in your NabLab application.
Note that <code>$MONILOG_HOME</code> refers to an environment variable which must be defined and point to the folder containing <code>utils.py</code>.</p>
<h3 id="setup">Setup</h3>
<p>A MoniLog specification file can contain a <code>setup</code> block after the imports, allowing to declare global variables that can be used by moniloggers.
The following specification defines 3 variables, the last one being assigned a string including the current date through a <code>StringLayout</code> and a call to a function defined in <code>utils.py</code>.</p>
<div class="highlight"><pre><span></span><code>setup {
    lastDump = 0.0;
    outputInterval = 0.001;
    filePath = StringLayout.call(&quot;$MONILOG_HOME/NabLabExamples/iterativeheatequation_{0}.csv&quot;, python(utils.date()));
}
</code></pre></div>
<h3 id="events">Events</h3>
<p>Events are declared using the following syntax:</p>
<div class="highlight"><pre><span></span><code>event Initialized {
    after call InitU
}

event BeforeComputeTn {
    before call ComputeTn
}

event AfterWriteResidual {
    after write residual
}
</code></pre></div>
<p>This snippet declares three events, <code>Initialized</code>, <code>BeforeComputeTn</code> and <code>AfterWriteResidual</code>, to which moniloggers can listen during the execution.
These events are respectively fired after calls to <code>InitU</code>, before calls to <code>ComputeTn</code>, and after any value is assigned to <code>residual</code>.</p>
<h3 id="expressions">Expressions</h3>
<p>The other entities (namely, layouts and appenders) make use of expressions, which can be MoniLog expressions or language expressions.
In MoniLog expressions, references to variables of the context of the instrumented program can be done through the <code>context</code> operator, such as <code>context(x) * 2</code>, <code>sizeOf(context(u_nplus1))</code>, or <code>context(u_nplus1)[0]</code>.
Language expressions are calls to functions defined in imported files, such as <code>python(utils.stdev(context(u_n))</code>.
Any language available on your GraalVM installation can be used by specifying the language id instead of <code>python</code> in the examples.</p>
<p>MoniLog also offers some native support for expressions, providing the following operators, in order of priority:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ternary Operator</td>
<td><code>&lt;condition&gt; ? &lt;result if **true**&gt; : &lt;result if **false**&gt;</code></td>
</tr>
<tr>
<td>Or</td>
<td><code>||</code></td>
</tr>
<tr>
<td>And</td>
<td><code>&amp;&amp;</code></td>
</tr>
<tr>
<td>Equality, Inequality</td>
<td><code>==</code>, <code>!=</code></td>
</tr>
<tr>
<td>Plus, Subtract</td>
<td><code>+</code>, <code>-</code></td>
</tr>
<tr>
<td>Multiplication, Division</td>
<td><code>*</code>, <code>/</code></td>
</tr>
<tr>
<td>Modulo</td>
<td><code>%</code></td>
</tr>
<tr>
<td>Parenthesis, Minus, Negation</td>
<td><code>(&lt;expression&gt;)</code>, <code>-&lt;expression&gt;</code>, <code>!&lt;expression&gt;</code></td>
</tr>
</tbody>
</table>
<p>Finally, array and field access are respectively written as <code>someArray[someIndice]</code> and <code>someObject.someField</code>.
Both of these kinds of access can be chained, <em>e.g.</em>, <code>someObject.arrayField[0].anotherField</code>.</p>
<h3 id="layouts">Layouts</h3>
<p>The <code>StringLayout</code> allows to insert the result values of any MoniLog expression or language call into a string template.
The first parameter of a call to <code>StringLayout</code> is the pattern of the message, where curly braces such as <code>{0,number,0.000000}</code> indicate where the subsequent parameters should be inserted in the message, and how they should be formatted, according to the semantics of <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/text/MessageFormat.html?is-external=true">MessageFormat</a>.
Consequently, the following parameters are expressions retrieving and computing the actual values to insert in the message.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Scientific formating can be achieved using <code>{0,number,0.000000E0}</code>.</p>
</div>
<p>The following snippet shows how to use the <code>StringLayout</code> to format a message displaying the standard deviation of the <code>u_n</code> array (obtained from a language call) at each time step of the simulation:</p>
<div class="highlight"><pre><span></span><code>StringLayout.call(&quot;[t={0,number,0.00000}] Temperature Standard Deviation: {1,number,0.000000E0}&quot;,
            context(t_n), python(utils.stdev(context(u_n))))
</code></pre></div>
<h3 id="moniloggers">Moniloggers</h3>
<p>Moniloggers are defined according to one of these templates:</p>
<div class="highlight"><pre><span></span><code>when &lt;event&gt; {
    &lt;actions&gt;
}
</code></pre></div>
<div class="highlight"><pre><span></span><code>when &lt;event&gt;
if (&lt;condition&gt;)
then {
    &lt;actions&gt;
}
</code></pre></div>
<div class="highlight"><pre><span></span><code>when &lt;event&gt;
if (&lt;condition&gt;)
then {
    &lt;actions&gt;
} else {
    &lt;actions&gt;
}
</code></pre></div>
<h4 id="conditions">Conditions</h4>
<p>Conditions are expressions written in the native MoniLog expression language, or a language available on your GraalVM installation, whose result are interpreted as a boolean (i.e., any value different than 0 is considered as true).
Conditions can be used to determine whether a particular event should trigger the actions of a monilogger, according to the current state of the program under execution.
Optionally, a different set of actions can be triggered when the condition evaluates to <code>false</code>, using an <code>else</code> block after the <code>then</code> block (see above).</p>
<p>In the following monilogger, a condition specifies that actions should only be triggered if the sum of MoniLog variables <code>lastDump</code> and <code>outputInterval</code> are lesser than or equal to the NabLab variable <code>t_n</code>.</p>
<div class="highlight"><pre><span></span><code>monilogger LogTemperature {
    when ComputeTnReturned
    if (lastDump + outputInterval &lt;= context(t_n))
    then {
        ...
    }
}
</code></pre></div>
<h4 id="actions">Actions</h4>
<p>Two types of actions are available to moniloggers: calling appenders and assigning values.
Two appenders are provided as part of the MoniLog standard library: <code>ConsoleAppender</code> and <code>FileAppender</code>.
An additional appender is provided by the MoniLog4NabLab extension: the <code>NabLabConsoleAppender</code> allowing to print to NabLab's console.</p>
<h5 id="printing-to-the-console">Printing to the console</h5>
<p>The <code>NabLabConsoleAppender</code> allows to print text to the NabLab console.
The following monilogger uses the <code>NabLabConsoleAppender</code> and the <code>StringLayout</code> to print to the console the current value of the <code>residual</code> variable, along with the current values of <code>n</code> and <code>k</code>.</p>
<div class="highlight"><pre><span></span><code>monilogger PrintResidual {
    when ResidualUpdated {
        NabLabConsoleAppender.call(
            StringLayout.call(&quot;[n={0,number,000}, k={1,number,00}] current residual: {2,number,0.0E0}&quot;,
            context(n), context(k), context(residual)));
}
</code></pre></div>
<h5 id="printing-to-a-file">Printing to a file</h5>
<p>The <code>FileAppender</code> allows to print text to a file.
The following monilogger prints the current value of <code>t_n</code> along with the values of <code>u_n</code>, formatted in CSV format using a Python function, to a file located at the path indicated by <code>filePath</code> (computed as part of the setup block of the specification).</p>
<div class="highlight"><pre><span></span><code>monilogger LogTemperature {
    when UpdateUReturned {
        FileAppender.call(StringLayout.call(&quot;{0,number,0.00000}, {1}&quot;, context(t_nplus1), python(utils.format(context(u_n)))), filePath);
    }
}
</code></pre></div>
<h5 id="assigning-values">Assigning values</h5>
<p>The following monilogger adds an interval between each write to file, controled by the <code>outputInterval</code> variable.
The <code>lastDump</code> variable is then incremented by the value of <code>outputInterval</code>.</p>
<div class="highlight"><pre><span></span><code>monilogger LogTemperature {
    when ComputeTnReturned
    if (lastDump + outputInterval &lt;= context(t_n))
    then {
        FileAppender.call(StringLayout.call(&quot;{0,number,0.00000}, {1}&quot;, context(t_n), python(utils.format(context(u_n)))), filePath);
        lastDump = lastDump + outputInterval
    }
}
</code></pre></div>
<h2 id="complete-examples">Complete examples</h2>
<p>The following specification allows to monitor whether the <code>residual</code> variable is updated as expected, and logs error messages with current and previous <code>residual</code> values when that is not the case.</p>
<div class="highlight"><pre><span></span><code>package iterativeHeatEquation

import org.gemoc.monilog.stl.*
import fr.cea.nabla.monilog.nablalib.*
import IterativeHeatEquation.*

setup {
    prevResidual = 1.0;
}

event ComputeTnReturned {
    after call ComputeTn
}

event ResidualUpdated {
    after call ComputeResidual
}

monilogger correctResidual {
    when ResidualUpdated
    if (context(residual) &gt; prevResidual)
    then {
        NabLabConsoleAppender.call(
            StringLayout.call(&quot;[n={0,number,000}, k={1,number,00}] current residual: {2,number,0.0E0}, previous residual: {3,number,0.0E0}&quot;,
            context(n), context(k), context(residual), prevResidual));
        prevResidual = context(residual);
    } else {
        prevResidual = context(residual);
    }
}

monilogger resetResidual {
    when ComputeTnReturned
    {
        prevResidual = 1.0;
    }
}
</code></pre></div>
<p>The following specification allows to log to file the values of <code>u_n</code> at faster interval in the beginning of the execution than toward the end.
Results are written to a file named <code>iterativeheatequation_&lt;date-of-execution&gt;.csv</code> (Python file provided below).</p>
<div class="highlight"><pre><span></span><code>package iterativeHeatEquation

import org.gemoc.monilog.stl.*
import fr.cea.nabla.monilog.nablalib.*
import IterativeHeatEquation.*
import &quot;$MONILOG_HOME/monilog-libraries/utils.py&quot; as utils

setup {
    lastDump = 0.0;
    outputInterval = 0.00025;
    filePath = StringLayout.call(&quot;$MONILOG_HOME/NabLabExamples/iterativeheatequation_{0}.csv&quot;, python(utils.date()));
}

event ComputeTnReturned {
    after call ComputeTn
}

monilogger LogTemperature {
    when ComputeTnReturned
    if (lastDump + outputInterval &lt;= context(t_n))
    then {
        FileAppender.call(StringLayout.call(&quot;{0,number,0.00000}, {1}&quot;, context(t_n), python(utils.format(context(u_n)))), filePath);
        lastDump = lastDump + outputInterval
    }
}

monilogger IncreaseInterval {
    when ComputeTnReturned
    if (context(t_nplus1) &gt;= 0.01)
    then {
        outputInterval = 0.01;
    }
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">date</span><span class="p">():</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m-</span><span class="si">%d</span><span class="s2">-%Y_%H:%M:%S&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../modulecomposition/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Composing modules" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Composing modules
            </div>
          </div>
        </a>
      
      
        
        <a href="../nablablanguage/" class="md-footer__link md-footer__link--next" aria-label="Next: NabLab language reference" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              NabLab language reference
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2022 CEA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/cea-hpc/NabLab" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.instant"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": "0.4.0"}</script>
    
    
      <script src="../assets/javascripts/bundle.d6c3db9e.min.js"></script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>